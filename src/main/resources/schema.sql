CREATE TABLE IF NOT EXISTS Groups
(
    id   BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(50) UNIQUE
);

CREATE TABLE IF NOT EXISTS Universities
(
    id   BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(100) UNIQUE
);

CREATE TABLE IF NOT EXISTS Students
(
    chat_id         BIGINT PRIMARY KEY,
    name            VARCHAR(255),
    surname         VARCHAR(255),
    father_name     VARCHAR(255),
    university_name VARCHAR(100) REFERENCES Universities (name),
    group_name      VARCHAR(50) REFERENCES Groups (name)
);

CREATE TABLE IF NOT EXISTS Disciplines
(
    id   BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(100) UNIQUE
);

CREATE TABLE IF NOT EXISTS Tests
(
    test_id         BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    test_name       VARCHAR(100),
    discipline_name VARCHAR(100) REFERENCES Disciplines (name)
);

CREATE TABLE IF NOT EXISTS Discipline_Groups
(
    discipline_group_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    discipline_id       BIGINT REFERENCES Disciplines (id),
    group_id            BIGINT REFERENCES Groups (id)
);

CREATE TABLE IF NOT EXISTS Questions
(
    id            BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    question_text TEXT NOT NULL
);
CREATE TABLE IF NOT EXISTS Answers
(
    id          BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    question_id BIGINT REFERENCES Questions (id),
    answer      TEXT,
    correct     BOOLEAN DEFAULT FALSE
);

CREATE TABLE IF NOT EXISTS Test_Questions
(
    id          BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    test_id     BIGINT REFERENCES Tests (test_id),
    question_id BIGINT REFERENCES Questions (id)
);
CREATE TABLE IF NOT EXISTS Results
(
    id          BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id     BIGINT REFERENCES Students (chat_id),
    test_id     BIGINT REFERENCES Tests (test_id),
    question_id BIGINT REFERENCES Questions (id),
    answer      TEXT NOT NULL
);
CREATE TABLE IF NOT EXISTS Users
(
    id          BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    fullname    TEXT,
    description TEXT,
    password    TEXT NOT NULL,
    email       TEXT NOT NULL,
    role        TEXT
);
CREATE TABLE IF NOT EXISTS Users_Groups
(
    id       BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    group_id BIGINT REFERENCES Groups (id),
    user_id  BIGINT REFERENCES Users (id) ON DELETE CASCADE
);

INSERT INTO Users (fullname, description, password, email, role)
VALUES ('superadmin', 'superadmin', '$2a$04$Fx/SX9.BAvtPlMyIIqqFx.hLY2Xp8nnhpzvEEVINvVpwIPbA3v/.i',
        'superadmin', 'ROLE_SUPERADMIN');

INSERT INTO Universities(id, name)
VALUES (1000, 'Университет "Дубна"');

INSERT INTO Groups(id, name)
VALUES (1000, '4253'),
       (2000, '4254'),
       (3000, '4255');
INSERT INTO Disciplines (id, name)
VALUES (1000, 'Mathematics'),
       (2000, 'Physics'),
       (3000, 'Computer Science');
INSERT INTO Discipline_Groups (discipline_group_id, discipline_id, group_id)
VALUES (1000, 1000, 1000),
       (2000, 2000, 1000),
       (3000, 2000, 2000),
       (4000, 1000, 2000),
       (5000, 3000, 3000),
       (6000, 3000, 1000),
       (7000, 3000, 2000),
       (8000, 2000, 3000);

INSERT INTO Tests (test_id, test_name, discipline_name)
VALUES (1000, 'Math Test 1', 'Mathematics'),
       (2000, 'Physics Test 1', 'Physics'),
       (3000, 'Programming Test 1', 'Computer Science');
INSERT INTO Questions (id, question_text)
VALUES (1000, 'What is 2 + 2?'),
       (2000, 'What is the capital of France?'),
       (3000, 'What is the main programming language in this course?');
INSERT INTO Answers (id, question_id, answer, correct)
VALUES (1000, 1000, '4', TRUE),
       (2000, 1000, '5', FALSE),
       (3000, 2000, 'Paris', TRUE),
       (4000, 3000, 'Java', TRUE),
       (5000, 3000, 'Python', FALSE);
INSERT INTO Test_Questions (id, test_id, question_id)
VALUES (1000, 1000, 1000),
       (2000, 1000, 2000),
       (3000, 2000, 1000),
       (4000, 2000, 3000),
       (5000, 3000, 2000),
       (6000, 1000, 3000);






